---
name: "release"

# Run only manually for now
on:
  workflow_dispatch

jobs:
  pre-release:
    name: "Release"
    runs-on: "ubuntu-latest"

    steps:
      # ..
      - name: "Checkout repo"
        uses: actions/checkout@v3
      - name: "Generate language versions"
        run: |
          ./dacode -t .translations/ -c Scripts/ -i cp1252 -o release/
      - name: "ls"
        run: |
          ls release
      - name: "Prepare a release"
        run: |
          #!/bin/bash

          SOURCE_DIR="./release"
          TARGET_DIR="../zipped"

          # Create the target directory if it doesn't exist
          mkdir -p "./zipped"

          # Loop through the directories in the source directory
          for dir in "$SOURCE_DIR"/*; do
          # Check if the item is a directory
          if [ -d "$dir" ]; then
            # Extract the directory name
            dir_name=$(basename "$dir")

            # Change the working directory to the parent directory of the directory to compress
            cd "$(dirname "$dir")"
            # Compress the directory into a zip file
            zip_file="$TARGET_DIR/$dir_name.zip"
            zip -r -q -v "$zip_file" "$dir_name"
            echo "Compressed $dir_name to $zip_file"
            # Change the working directory back to the original directory
            cd - > /dev/null
          fi
          done
      - name: "Release"
        uses: softprops/action-gh-release@v1
        with:
          files: |
             ./zipped/*.zip
